var e=Object.defineProperty,a=(a,s,t)=>(((a,s,t)=>{s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t})(a,"symbol"!=typeof s?s+"":s,t),t);import{j as s,C as t,d as r,e as l,b as n,S as i,f as o,g as c,h as d,i as m,I as x,B as h}from"./dashboard-features-d9d15042.js";import{r as u}from"./react-vendor-b18ea2cb.js";import{L as N,A as g,a as b,l as j,B as y,u as p,c as f}from"./admin-features-fcd29654.js";import{u as v}from"./useSalesData-329b0fde.js";import{T as _}from"./textarea-5d669d9c.js";import{h as T,y as w,q as E,X as S,D as A,l as M,t as O,u as C,Z as D,i as L,r as R}from"./ui-vendor-ea3e37df.js";import"./charts-vendor-c49a018f.js";import"./firebase-vendor-b3492e98.js";const V={SALES_AMOUNT:{MIN:0,MAX:1e6},TREATMENTS_COUNT:{MIN:0,MAX:1e3},TEXT_LENGTH:{TITLE_MAX:100,CONTENT_MAX:2e3,NOTES_MAX:500}};class I{constructor(e,s=[],t){a(this,"isValid"),a(this,"errors"),a(this,"sanitizedValue"),this.isValid=e,this.errors=s,this.sanitizedValue=t}}const U=e=>"string"!=typeof e?"":e.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").slice(0,V.TEXT_LENGTH.CONTENT_MAX),X=e=>{const a=parseFloat(e);return isNaN(a)?0:a},z=e=>{const a=[],s=X(e);return s<V.SALES_AMOUNT.MIN&&a.push({field:"daily_sales",message:"Sales amount cannot be negative",code:"SALES_AMOUNT_TOO_LOW"}),s>V.SALES_AMOUNT.MAX&&a.push({field:"daily_sales",message:`Sales amount cannot exceed $${V.SALES_AMOUNT.MAX.toLocaleString()}`,code:"SALES_AMOUNT_TOO_HIGH"}),new I(0===a.length,a,s)},k=e=>{const a=[],s=X(e);return s<V.TREATMENTS_COUNT.MIN&&a.push({field:"treatments_count",message:"Treatments count cannot be negative",code:"TREATMENTS_COUNT_TOO_LOW"}),s>V.TREATMENTS_COUNT.MAX&&a.push({field:"treatments_count",message:`Treatments count cannot exceed ${V.TREATMENTS_COUNT.MAX}`,code:"TREATMENTS_COUNT_TOO_HIGH"}),new I(0===a.length,a,Math.floor(s))},F=e=>{const a=[];return e&&"string"==typeof e?(N.includes(e)||a.push({field:"location",message:"Invalid location selected",code:"LOCATION_INVALID"}),new I(0===a.length,a,e)):(a.push({field:"location",message:"Location is required",code:"LOCATION_REQUIRED"}),new I(!1,a))},H=e=>{const a=[];if(!e)return a.push({field:"date",message:"Date is required",code:"DATE_REQUIRED"}),new I(!1,a);const s=new Date(e);if(isNaN(s.getTime()))return a.push({field:"date",message:"Invalid date format",code:"DATE_INVALID"}),new I(!1,a);const t=new Date;return t.setFullYear(t.getFullYear()+1),s>t&&a.push({field:"date",message:"Date cannot be more than 1 year in the future",code:"DATE_TOO_FUTURE"}),new I(0===a.length,a,s.toISOString().split("T")[0])},$=(e,a=V.TEXT_LENGTH.CONTENT_MAX)=>{const s=[];if("string"!=typeof e)return new I(!0,[],"");const t=U(e);return t.length>a&&s.push({field:"text",message:`Text cannot exceed ${a} characters`,code:"TEXT_TOO_LONG"}),new I(0===s.length,s,t)},q=e=>{const a=[],s={},t=F(e.location);t.isValid?s.location=t.sanitizedValue:a.push(...t.errors);const r=H(e.date);r.isValid?s.date=r.sanitizedValue:a.push(...r.errors);const l=z(e.daily_sales);if(l.isValid?s.daily_sales=l.sanitizedValue:a.push(...l.errors),void 0!==e.treatments_count&&""!==e.treatments_count){const t=k(e.treatments_count);t.isValid?s.treatments_count=t.sanitizedValue:a.push(...t.errors)}if(e.notes){const t=$(e.notes,V.TEXT_LENGTH.NOTES_MAX);t.isValid?s.notes=t.sanitizedValue:a.push(...t.errors)}return new I(0===a.length,a,s)},G=["Flatiron","MidEast","Midtown","UWS","Back Bay","North Station","Miami Beach","eStore","Location 9","Location 10"];function Q({record:e,onSave:a,onCancel:N,isAdmin:y,userLocation:p}){var f,v;const[A,M]=u.useState({location:(null==e?void 0:e.location)||(y?"":p||"Flatiron"),date:(null==e?void 0:e.date)||T(new Date,"yyyy-MM-dd"),daily_sales:(null==(f=null==e?void 0:e.daily_sales)?void 0:f.toString())||"",treatments_count:(null==(v=null==e?void 0:e.treatments_count)?void 0:v.toString())||"",notes:(null==e?void 0:e.notes)||""}),[O,C]=u.useState(!1),[D,L]=u.useState([]);return s.jsxs(t,{className:"bg-[#1a1a1a] border-[#bc9a64]/20",children:[s.jsx(r,{children:s.jsxs(l,{className:"text-white flex items-center gap-2",children:[s.jsx(w,{className:"w-5 h-5 text-[#bc9a64]"}),e?"Edit Sales Record":"New Sales Entry"]})}),s.jsxs(n,{children:[D.length>0&&s.jsxs(g,{className:"mb-6 border-red-500/20 bg-red-500/10",children:[s.jsx(E,{className:"h-4 w-4 text-red-400"}),s.jsx(b,{className:"text-red-300",children:s.jsx("div",{className:"space-y-1",children:D.map((e,a)=>s.jsx("div",{children:e.message},a))})})]}),s.jsxs("form",{onSubmit:async s=>{s.preventDefault(),C(!0),L([]);try{const s=q({location:A.location,date:A.date,daily_sales:A.daily_sales,treatments_count:A.treatments_count,notes:A.notes});if(!s.isValid)return L(s.errors),void C(!1);await a(s.sanitizedValue),e||M({location:y?"":p||"Flatiron",date:T(new Date,"yyyy-MM-dd"),daily_sales:"",treatments_count:"",notes:""})}catch(t){j.error("Error submitting sales form",t),L([{field:"general",message:"An error occurred while saving. Please try again.",code:"SAVE_ERROR"}])}finally{C(!1)}},className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[y&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Location"}),s.jsxs(i,{value:A.location,onValueChange:e=>M(a=>({...a,location:e})),children:[s.jsx(o,{className:"bg-[#0e0e0e] border-[#333] text-white",children:s.jsx(c,{placeholder:"Select location"})}),s.jsx(d,{className:"bg-[#1a1a1a] border-[#bc9a64]/20",children:G.map(e=>s.jsx(m,{value:e,className:"text-white hover:bg-[#bc9a64]/10",children:e},e))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Date"}),s.jsx(x,{type:"date",value:A.date,onChange:e=>M(a=>({...a,date:e.target.value})),className:"bg-[#0e0e0e] border-[#333] text-white focus:border-[#bc9a64]",required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Daily Sales ($)"}),s.jsx(x,{type:"number",step:"0.01",min:"0",value:A.daily_sales,onChange:e=>M(a=>({...a,daily_sales:e.target.value})),className:"bg-[#0e0e0e] border-[#333] text-white focus:border-[#bc9a64]",placeholder:"0.00",required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Number of Treatments"}),s.jsx(x,{type:"number",min:"0",value:A.treatments_count,onChange:e=>M(a=>({...a,treatments_count:e.target.value})),className:"bg-[#0e0e0e] border-[#333] text-white focus:border-[#bc9a64]",placeholder:"0"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Notes (Optional)"}),s.jsx(_,{value:A.notes,onChange:e=>M(a=>({...a,notes:e.target.value})),className:"bg-[#0e0e0e] border-[#333] text-white focus:border-[#bc9a64] h-24",placeholder:"Add any notes about the day's performance..."})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsxs(h,{type:"button",variant:"outline",onClick:N,className:"border-[#333] text-gray-300 hover:bg-[#333]/50",children:[s.jsx(S,{className:"w-4 h-4 mr-2"}),"Cancel"]}),s.jsxs(h,{type:"submit",disabled:O||!y&&!p,className:"bg-gradient-to-r from-[#bc9a64] to-[#d4b876] hover:from-[#a8875a] hover:to-[#c1a56b] text-[#0e0e0e] font-semibold",children:[O?s.jsx("div",{className:"w-4 h-4 border-2 border-[#0e0e0e] border-t-transparent rounded-full animate-spin mr-2"}):s.jsx(w,{className:"w-4 h-4 mr-2"}),e?"Update":"Save"," Entry"]})]})]})]})]})}function B({records:e,onEdit:a,onDelete:i,showLocation:o=!1}){const c=[...e].sort((e,a)=>new Date(a.date).getTime()-new Date(e.date).getTime());return 0===e.length?s.jsx(t,{className:"bg-[#1a1a1a] border-[#bc9a64]/20",children:s.jsxs(n,{className:"p-12 text-center",children:[s.jsx(A,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Sales Records"}),s.jsx("p",{className:"text-gray-400",children:"No sales records found. Create your first entry using the form above."})]})}):s.jsxs(t,{className:"bg-[#1a1a1a] border-[#bc9a64]/20",children:[s.jsx(r,{children:s.jsxs(l,{className:"text-white",children:["Sales Records (",e.length,")"]})}),s.jsx(n,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-[#bc9a64]/20",children:[s.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-medium",children:"Date"}),o&&s.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-medium",children:"Location"}),s.jsx("th",{className:"text-right py-3 px-4 text-gray-300 font-medium",children:"Sales"}),s.jsx("th",{className:"text-right py-3 px-4 text-gray-300 font-medium",children:"Treatments"}),s.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-medium",children:"Notes"}),s.jsx("th",{className:"text-right py-3 px-4 text-gray-300 font-medium",children:"Actions"})]})}),s.jsx("tbody",{children:c.map(e=>s.jsxs("tr",{className:"border-b border-[#bc9a64]/10 hover:bg-[#bc9a64]/5 transition-colors",children:[s.jsxs("td",{className:"py-4 px-4",children:[s.jsx("div",{className:"text-white font-medium",children:T(new Date(e.date),"MMM d, yyyy")}),s.jsx("div",{className:"text-sm text-gray-400",children:T(new Date(e.date),"EEEE")})]}),o&&s.jsx("td",{className:"py-4 px-4",children:s.jsxs(y,{variant:"outline",className:"text-gray-300 border-gray-600",children:[s.jsx(M,{className:"w-3 h-3 mr-1"}),e.location]})}),s.jsx("td",{className:"py-4 px-4 text-right",children:s.jsxs("div",{className:"text-white font-semibold",children:["$",e.daily_sales.toLocaleString()]})}),s.jsx("td",{className:"py-4 px-4 text-right",children:s.jsx("div",{className:"text-white",children:e.treatments_count||0})}),s.jsx("td",{className:"py-4 px-4",children:s.jsx("div",{className:"max-w-xs",children:e.notes?s.jsx("p",{className:"text-sm text-gray-300 truncate",children:e.notes}):s.jsx("span",{className:"text-gray-500 text-sm",children:"No notes"})})}),s.jsx("td",{className:"py-4 px-4",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(h,{variant:"ghost",size:"sm",onClick:()=>a(e),className:"text-gray-400 hover:text-[#bc9a64] hover:bg-[#bc9a64]/10",children:s.jsx(O,{className:"w-4 h-4"})}),s.jsx(h,{variant:"ghost",size:"sm",onClick:()=>i(e.id),className:"text-gray-400 hover:text-red-400 hover:bg-red-500/10",children:s.jsx(C,{className:"w-4 h-4"})})]})})]},e.id))})]})})})]})}function P({onQuickEntry:e,selectedDate:a,onDateChange:y,isAdmin:p}){const[f,v]=u.useState(""),[_,T]=u.useState(""),[w,S]=u.useState(""),[A,M]=u.useState([]);return s.jsxs(t,{className:"bg-[#1a1a1a] border-[#bc9a64]/20",children:[s.jsx(r,{children:s.jsxs(l,{className:"text-white flex items-center gap-2",children:[s.jsx(D,{className:"w-5 h-5 text-[#bc9a64]"}),"Quick Entry"]})}),s.jsxs(n,{children:[A.length>0&&s.jsxs(g,{className:"mb-4 border-red-500/20 bg-red-500/10",children:[s.jsx(E,{className:"h-4 w-4 text-red-400"}),s.jsx(b,{className:"text-red-300",children:s.jsx("div",{className:"space-y-1",children:A.map((e,a)=>s.jsx("div",{children:e.message},a))})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 items-end",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Date"}),s.jsxs("div",{className:"relative",children:[s.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(x,{type:"date",value:a,onChange:e=>y(e.target.value),className:"pl-10 bg-[#0e0e0e] border-[#333] text-white focus:border-[#bc9a64]"})]})]}),p&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Location"}),s.jsxs(i,{value:w,onValueChange:S,children:[s.jsx(o,{className:"bg-[#0e0e0e] border-[#333] text-white",children:s.jsx(c,{placeholder:"Select location"})}),s.jsx(d,{className:"bg-[#1a1a1a] border-[#bc9a64]/20",children:N.map(e=>s.jsx(m,{value:e,className:"text-white hover:bg-[#bc9a64]/10",children:e},e))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Sales ($)"}),s.jsx(x,{type:"number",step:"0.01",min:"0",value:f,onChange:e=>v(e.target.value),className:"bg-[#0e0e0e] border-[#333] text-white focus:border-[#bc9a64]",placeholder:"0.00"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Treatments"}),s.jsx(x,{type:"number",min:"0",value:_,onChange:e=>T(e.target.value),className:"bg-[#0e0e0e] border-[#333] text-white focus:border-[#bc9a64]",placeholder:"0"})]}),s.jsxs(h,{onClick:()=>{M([]);try{const s=q({location:p?w:void 0,date:a,daily_sales:f,treatments_count:_});if(!s.isValid)return void M(s.errors);const t={daily_sales:s.sanitizedValue.daily_sales,treatments_count:s.sanitizedValue.treatments_count,...p&&w&&{location:s.sanitizedValue.location||w}};e(t),v(""),T(""),S(""),M([])}catch(s){j.error("Error in quick entry",s),M([{field:"general",message:"An error occurred. Please try again.",code:"QUICK_ENTRY_ERROR"}])}},disabled:!f||p&&!w,className:"bg-gradient-to-r from-[#bc9a64] to-[#d4b876] hover:from-[#a8875a] hover:to-[#c1a56b] text-[#0e0e0e] font-semibold",children:[s.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Entry"]})]})]})]})}function W(){const[e,a]=u.useState(!1),[t,r]=u.useState(null),[l,n]=u.useState(T(new Date,"yyyy-MM-dd")),{user:i,loading:o}=p(),{salesData:c,loading:d,createSalesRecord:m,updateSalesRecord:x,deleteSalesRecord:N}=v({userLocation:null==i?void 0:i.location,isAdmin:null==i?void 0:i.is_admin});return o||d?s.jsx("div",{className:"min-h-screen bg-[#0e0e0e] flex items-center justify-center",children:s.jsx("div",{className:"w-8 h-8 border-2 border-[#bc9a64] border-t-transparent rounded-full animate-spin"})}):s.jsx("div",{className:"min-h-screen bg-[#0e0e0e] text-white p-6",children:s.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Sales Entry"}),s.jsx("p",{className:"text-gray-400",children:(null==i?void 0:i.is_admin)?"Manage sales data for all locations":`Manage sales for ${(null==i?void 0:i.location)||"your location"}`})]}),s.jsxs(h,{onClick:()=>a(!0),className:"bg-gradient-to-r from-[#bc9a64] to-[#d4b876] hover:from-[#a8875a] hover:to-[#c1a56b] text-[#0e0e0e] font-semibold",children:[s.jsx(R,{className:"w-5 h-5 mr-2"}),"New Entry"]})]}),s.jsx(P,{onQuickEntry:async e=>{try{const a={...e,location:(null==i?void 0:i.is_admin)?e.location:(null==i?void 0:i.location)||"Flatiron",date:l};await m(a)}catch(a){j.error("Error with quick entry",a)}},selectedDate:l,onDateChange:n,isAdmin:null==i?void 0:i.is_admin}),e&&s.jsx(Q,{record:t||void 0,onSave:async e=>{try{t?await x(t.id,e):((null==i?void 0:i.is_admin)||(e.location=(null==i?void 0:i.location)||"Flatiron"),await m(e)),a(!1),r(null)}catch(s){j.error("Error saving sales record",s)}},onCancel:()=>{a(!1),r(null)},isAdmin:(null==i?void 0:i.is_admin)||!1,userLocation:(null==i?void 0:i.location)||"Flatiron"}),s.jsx(B,{records:c,onEdit:e=>{r(e),a(!0)},onDelete:async e=>{if(window.confirm("Are you sure you want to delete this record?"))try{const a=c.find(a=>a.id===e);await N(e),await f.logSalesRecord("delete",e,a,null)}catch(a){j.error("Error deleting sales record",a)}},showLocation:null==i?void 0:i.is_admin})]})})}export{W as default};
//# sourceMappingURL=SalesEntry-f57a6606.js.map
